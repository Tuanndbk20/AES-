package aes;

import java.math.BigInteger;
import java.util.HashMap;


public class DemoAES {
	
//	public static void main(String[] args) throws NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException,
//			IllegalBlockSizeException, BadPaddingException {
//		
//		/* change key 8bit*/
////		String SECRET_KEY = "0123456789abcdef0123456789abcdef";
//		String SECRET_KEY = "5f5e1f20b4a333f8cdf1f04251ac0f93300bf1a9ce5b5436cd4b47b0c6a1ffab";
//		String original = "74656d70657261747572657c7c73696c7665727c7c633035303165376563343064363637383862996437399235353035393564376234373162663134643431646362623139633732653536333064323935383032657c7c39353832376162343832643766306532363431356638656262333532646163397c7c34306432653930363638303435386534376232356431373038363164336463346362313932616436353433366162306239643738653233383061623863626630";
//		String binary = "0101010000110111011110010100111101111000001100100110100101101111010000100101100000110111011011010111001001001010001100010100101000101111010011010111000001101101010110010101101001100011011001010111100001101000011101110101000100111001001011110111011001110111010101110011000001110111011000100011100001101100010010100100110101000011010101100111011101011010011100110111000001100110010110000110011001000011001110010111100101101110001101100100011100110011011101110110110101011000001011110111001001010110001100000101000101110000001101010101011101001111011001100011100001101111011101010110111001110001011010010011011001100110011101110101101001101011001100110110101001101100011100010110111000110001011011110011000000110011011100010100100101111000011011000111001101110101010100000100001000110000010010010100010101001100011100110101100101110111011011010100111001100100011010110110110101100001011010110101101001011000011011110110101000101011011001100011000101110001011100000011010000110100001101110101001001001000001110010100011101010010010010000100110101011010001100110100011100111001010100100111100100110100011100110110011000110110011011100101100101000111011010000100101101000101010001110101011101101101010011110100111001110011010000010110010101100100010010010111011001011010011001100111010000110111011000100110100000110010001101100111100101000110011100010101101001110011010011100110001001100011011110010101010101001010011010000111000101010001011001110011001101010110001100100101100101001001011110000110100101111010010000010110001101100101010000100110011101011010010011100011100100111000011000010101001101100011011010000011011001110011011101100100011101110000010101110101100101011000011101000111000101100011010010000100001001000001011001010110110001100011010101100110011101001011011100110111010001111010010110010100101001100111011101010100111001010010011101000110001000111001011001100110111101000100001101000111010100111001010010100110010101100011011100010110111101110100010100110101101001010001011010010100100101100110010100100110100001000111010010000101101000111001011001100100101101100100011100010011010101000010010101100011000101010101010010010011100001110000011001010100110001110010011100100011011101111000010011110100011101100001011001110100101101010000011001000010101101111010011010010100011001001110011001100100110001000111011001100110111100110101010000010011000101101011011100100111010100110010010110010110001101000001001101000110011101000100010001000100001100110011001011110101011001010111010011010101011101110000011000010110010001111001010011100111001101001101011100010110001001110011011101100110111001111000010001100111010101101001011010000100001101101000010011010110011001001010010100010100011100110010011010100111100101101111010011010111100101001100001100000100100001101101001100100100100101100011010101110010111101100001011101010011001101001000011010000110110101100001011110000111011101000100011001010111101001110000011100010100101101010001010010110100100000110001010110010110110001101011001100000111001001100011011101010111010101010011011110000101011001010110011110010100101101011000001110010100001000111001010101100111010100110100011110000110011101111000011001010011010001101111010110100100111101101000010110010011100100110001001101000111100001100110010010110100111100110101011011110011011001011000001100000101010000110101011101100110101000111000010001100100101001110100001101010100110101101010011100010111010001100001010101110111001001010101011000100011100001101111011100100011000101010011010011010111001001100100010010010010101101000111010011000111010001001100011100110101100001000010001101000110010001100011010011100100110101110000011000100100101001010110001101110100001101111010011011100100000100110100010001110110001100110011010001010100011001000100011011100011001000101011011000110100001101000100011100010101001100110110001110000100010101010110011000110111100000111000011011100101000001101101001100100111010001000100011100000101000001010001011110000100000101100010010011010100110001010001011101000100010001010010001110010100101101001001010100010101000101000010011101110100000101000110";
//		String hex = "5437794f7832696f4258376d724a314a2f4d706d595a636578687751392f767757307762386c4a4d4356775a73706658664339796e364733776d582f725630517035574f66386f756e71693666775a6b336a6c716e316f30337149786c737550423049454c7359776d4e646b6d616b5a586f6a2b663171703434375248394752484d5a3347395279347366366e5947684b4547576d4f4e7341656449765a667437626832367946715a734e626379554a68715167335632594978697a41636542675a4e3938615363683673764770575958747163484241656c6356674b73747a594a67754e52746239666f443475394a6563716f74535a51694966526847485a39664b64713542563155493870654c727237784f4761674b50642b7a69464e664c47666f3541316b7275325963413467444443332f56574d57706164794e734d716273766e784675696843684d664a5147326a796f4d794c30486d324963572f61753348686d61787744657a70714b514b4831596c6b307263757553785656794b5839423956753478677865346f5a4f685939313478664b4f356f3658305435766a38464a74354d6a71746157725562386f7231534d7264492b474c744c7358423464634e4d70624a5637437a6e41344763334546446e322b6343447153363845566378386e506d3274447050517841624d4c51744452394b49515142774146";
//		float total=0;
//		SecretKeySpec skeySpec;
//		for (int i = 0; i < 64; i++) {
////			skeySpec = new SecretKeySpec(hexStringToByteArray(SECRET_KEY), "AES");
//			skeySpec = new SecretKeySpec(hexStringToByteArray(ChangeAddBit(SECRET_KEY, i, 2)), "AES");
////			System.out.println(i+" key "+(ChangeAddBit(SECRET_KEY, i, 2)));
//			Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5PADDING");
//			cipher.init(Cipher.ENCRYPT_MODE, skeySpec);
//			byte[] byteEncrypted = cipher.doFinal(original.getBytes());
//			String encrypted = Base64.getEncoder().encodeToString(byteEncrypted);
//			
////			System.out.println("encrypt: "+toHex(encrypted));
//			String ciphertextHex = hexToBinary((toHex(encrypted)));
////			System.out.println("ciphertextHex binary: "+ciphertextHex);
////			total +=CompareBit(ciphertextHex,binary);
//			total +=CompareBit(toHex(encrypted),hex);
//			i++;
//			
//			cipher.init(Cipher.DECRYPT_MODE, skeySpec);
//			byte[] byteDecrypted = cipher.doFinal(byteEncrypted);
//			String decrypted = new String(byteDecrypted);
//		
//		
//		
////		/* change plaint 8bit*/
//////		String SECRET_KEY = "0123456789abcdef0123456789abcdef";
////		
////		String kzz = "5f5e1f20b4a333f8cdf1f04251ac0f93300bf1a9ce5b5436cd4b47b0c6a1ffab";
////		byte[] SECRET_KEY = hexStringToByteArray(kzz);
////		
////		String original = "74656d70657261747572657c7c73696c7665727c7c633035303165376563343064363637383862996437399235353035393564376234373162663134643431646362623139633732653536333064323935383032657c7c39353832376162343832643766306532363431356638656262333532646163397c7c34306432653930363638303435386534376232356431373038363164336463346362313932616436353433366162306239643738653233383061623863626630";
////		String binary = "01010001010100000011010001100011001110010100101001101101011110010100111001110001010100010100010101000111010001010100011101011010001010110010111100110011001110010110110001100111011010010111010101000011011100110100001101000101010100100100001100110100011001110110111001110110011010010101100101001000011010000100001001010011001101100111011001111000011001100100110101101101011101010011010001100111010011010101010101001000001011110011010000110000011011010100001001110111010100100011000101101000011110000111001101101111011011110101010001100110010000110100100100110100011110010100001100101111010011000100111001101100011101100100100001100010011101110010111101110000011010100100111101110101010000110101010101101100011001100110101101010111001011110011000101101100011101100101001101001110010011100100001000110010011010110101011101110011011010100110101001100110011010110101000001110100011011100111100000110010010001010100010101100101010110000110111101110001010101000011010101100101010001110110010001110110001100110011010000110101011110100011100101110111011110100111001001010011010000110101011001110110010011110110001101101001010101000101011001010110011100100100100001111001010100110111000001110101010101000110001001010010010101010011010001100010010100010100100001111001010101000011010100101011010101110010111101110000010000110100010000110010011010000110100101100110010100000111100001010001010100010110001001000010011001000111010101110011010010010110101001101110010001100100011100110111011110000111100101001000011001000100100101010000001011110100001101100100001100110110101000110111010110000100011100110000011011000110011101100011011000110011000000111001011101110110111001010111001100100110001001101000010000010110101101000110011010010100110001001110011001110100110001001101010100000011000101001100010011110111100001010100010010100110100001010010011000010100011001101110010101110110101100111000010001100011000101100011011001110100000101101110011001010101001001110101011101110111001001001000010110100111000100101111011110010011001001001000010010000100101001010001";
////		String hex = "51503463394a6d794e7151454745475a2b2f33396c67697543734345524334676e76695948684253367678664d6d7534674d55482f34306d427752316878736f6f546643493479432f4c4e6c764862772f706a4f7543556c666b572f316c76534e4e42326b57736a6a666b50746e7832454565586f715435654764763334357a39777a72534356764f636954565672487953707554625255346251487954352b572f70434432686966507851516242647573496a6e4647377879486449502f4364336a375847306c6763633039776e57326268416b46694c4e674c4d50314c4f78544a685261466e576b3846316367416e6552757772485a712f793248484a51";
////		float total=0;
////		SecretKeySpec skeySpec = new SecretKeySpec(SECRET_KEY, "AES");
//////		System.out.println(" length "+SECRET_KEY.getBytes().length);
////		for (int i = 0; i < 16; i++) {
//////			System.out.println(i+" plaintext "+ChangeAddBit(original, i, 2));
////			Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5PADDING");
////			cipher.init(Cipher.ENCRYPT_MODE, skeySpec);
////			byte[] byteEncrypted = cipher.doFinal(hexStringToByteArray(ChangeAddBit(original, i, 2)));//hexStringToByteArray(ChangeAddBit(original, i, 2))
////			String encrypted = Base64.getEncoder().encodeToString(byteEncrypted);
////			
//////			System.out.println("encrypt: "+toHex(encrypted));
////			System.out.println(toHex(encrypted));
////			String ciphertextHex = hexToBinary((toHex(encrypted)));
//////			System.out.println("ciphertextHex binary: "+ciphertextHex);
//////			total +=CompareBit(ciphertextHex,binary);
//////			total +=CompareBit(toHex(encrypted),hex);
////			i++;
////			
////			cipher.init(Cipher.DECRYPT_MODE, skeySpec);
////			byte[] byteDecrypted = cipher.doFinal(byteEncrypted);
////			String decrypted = new String(byteDecrypted);
//		
//		}
//	}
	
	public static void main(String[] args) {
		
//		String kzz = "5f5e1f20b4a333f8cdf1f04251ac0f93";//300bf1a9ce5b5436cd4b47b0c6a1ffab
		String kzz = "2475A2B33475568831E2120013AA5487";//300bf1a9ce5b5436cd4b47b0c6a1ffab
		byte[] Kz =hexStringToByteArray(kzz);
		String cleartext1 = "74656d70657261747572657c7c73696c7665727c7c633035303165376563343064363637383862996437399235353035393564376234373162663134643431646362623139633732653536333064323935383032657c7c39353832376162343832643766306532363431356638656262333532646163397c7c34306432653930363638303435386534376232356431373038363164336463346362313932616436353433366162306239643738653233383061623863626630";
		AESEngine Aes = new AESEngine();
		 
		Aes.init(true, new KeyParameter(Kz));
		
		byte[] ciphertext = new byte[hexStringToByteArray(cleartext1).length];
		int index=0;
		while(index<(ciphertext.length-Aes.getBlockSize())) {
		Aes.processBlock(hexStringToByteArray(cleartext1), index, ciphertext, index);
		index+=Aes.getBlockSize();
		}
		
		//process rest bytes
		byte[] block = new byte[Aes.getBlockSize()];
		System.arraycopy(hexStringToByteArray(cleartext1), index, block, 0, hexStringToByteArray(cleartext1).length-index);
		System.out.println("block: "+toHex(block));
		Aes.processBlock(block, 0, block, 0);
		System.out.println("block: "+toHex(block));
		System.arraycopy(block, 0, ciphertext, index, hexStringToByteArray(cleartext1).length-index);
		
		
		System.out.println("ciphertext: "+toHex(ciphertext));
	}
	
	

	/* Transform a byte array in an hexadecimal string */
	private static String toHex(byte[] data) {
		StringBuilder sb = new StringBuilder();
		for (byte b : data) {
			sb.append(String.format("%02x", b & 0xff));
		}
		return sb.toString();
	}

	/*
	 * Transform an hexadecimal string in byte array (It works if the string only
	 * contains the hexadecimal characters)
	 */
	private static byte[] hexStringToByteArray(String s) {
		int len = s.length();
		byte[] data = new byte[len / 2];
		for (int i = 0; i < len; i += 2) {
			data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) << 4) + Character.digit(s.charAt(i + 1), 16));
		}
		return data;
	}

	/* Convert a string representation in its hexadecimal string */
	private static String toHex(String arg) {
		return String.format("%02x", new BigInteger(1, arg.getBytes()));
	}


	static float CompareBit(String Str1, String Str2) {
		float Count = 0, a;
		if (Str1.length() == Str2.length()) {
			for (int i = 0; i < Str1.length(); i++) {
				if (Str1.charAt(i) == Str2.charAt(i))
					++Count;
			}
		} else {
			System.out.println("Length Str1 != Str2!");
		}
		a = ((Str1.length() - Count) / (Str1.length())) * 100;
//		System.out.println("so ki tu khac nhau: " + (Str1.length()-Count));
//		System.out.println("tong so ki tu: " + Str1.length());
//		System.out.println("ty le thay doi ban ma: " + a);
		System.out.println(a);
		return a;
	}

	// num la so bit can thay num*4=so bit can thay. addr la vi tri bat dau thay
	static String ChangeAddBit(String Str, int addr, int num) {
		StringBuilder str = new StringBuilder(Str);
		char Arr[] = { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f' };

		for (int j = 0; j < num; j++) {
			int i = 0;
			while (i < 16) {
				if (str.charAt(addr) == Arr[i]) {
					break;
				}
				i++;
			}
			str.setCharAt(addr, Arr[15 - i]);
			addr++;
		}
		return str.toString();
	}

	static String hexToBinary(String hex) {

		// variable to store the converted
		// Binary Sequence
		String binary = "";

		// converting the accepted Hexadecimal
		// string to upper case
		hex = hex.toUpperCase();

		// initializing the HashMap class
		HashMap<Character, String> hashMap = new HashMap<Character, String>();

		// storing the key value pairs
		hashMap.put('0', "0000");
		hashMap.put('1', "0001");
		hashMap.put('2', "0010");
		hashMap.put('3', "0011");
		hashMap.put('4', "0100");
		hashMap.put('5', "0101");
		hashMap.put('6', "0110");
		hashMap.put('7', "0111");
		hashMap.put('8', "1000");
		hashMap.put('9', "1001");
		hashMap.put('A', "1010");
		hashMap.put('B', "1011");
		hashMap.put('C', "1100");
		hashMap.put('D', "1101");
		hashMap.put('E', "1110");
		hashMap.put('F', "1111");

		int i;
		char ch;

		// loop to iterate through the length
		// of the Hexadecimal String
		for (i = 0; i < hex.length(); i++) {
			// extracting each character
			ch = hex.charAt(i);

			// checking if the character is
			// present in the keys
			if (hashMap.containsKey(ch))

				// adding to the Binary Sequence
				// the corresponding value of
				// the key
				binary += hashMap.get(ch);

			// returning Invalid Hexadecimal
			// String if the character is
			// not present in the keys
			else {
				binary = "Invalid Hexadecimal String";
				return binary;
			}
		}

		// returning the converted Binary
		return binary;
	}
}